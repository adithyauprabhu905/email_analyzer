<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Email Forensics Analyzer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&family=Roboto&display=swap" rel="stylesheet">
    <style>
        body {
            background: #16172a;
            color: #ffe;
            font-family: 'Roboto', sans-serif;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 2em 1em;
        }
        .container {
            background: rgba(20,22,38,0.97);
            border-radius: 32px;
            box-shadow: 0 8px 40px #30d0ff44;
            padding: 2.5em 2em 1em 2em;
            margin: 1em 0;
            max-width: 900px;
            width: 95vw;
            text-align: center;
        }
        h1 {
            font-family: 'Montserrat', sans-serif;
            color: #22ffe6;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 0.3em;
            text-shadow: 0 0 10px #00ffe6bb;
        }
        .accent {
            color: #f161ff;
            text-shadow: 0 0 8px #d601fc, 0 0 5px #00ffe7;
        }
        .file-input {
            background: #27284c;
            color: #22ffe6;
            border: 2px dashed #30d0ff;
            border-radius: 18px;
            padding: 2em 12px;
            margin: 1em 0 1.2em;
            cursor: pointer;
            font-size: 1.1em;
        }
        .file-input:hover {
            background: #181a32;
        }
        .futuristic-btn {
            background: linear-gradient(90deg, #22ffe6, #d601fc);
            box-shadow: 0 2px 12px #d601fc88;
            color: #fff;
            border: none;
            border-radius: 32px;
            padding: 0.85em 2em;
            cursor: pointer;
            font-size: 1.2em;
            font-family: 'Montserrat', sans-serif;
            margin: 1em 0 0.5em;
            transition: all 0.3s;
        }
        .futuristic-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px #d601fcaa;
        }
        .futuristic-btn:active {
            transform: scale(0.96);
            box-shadow: 0 0px 8px #d601fc77;
        }
        .info-card {
            margin: 1em 0;
            padding: 1.2em;
            background: rgba(35,30,56,0.87);
            border: 1.5px solid #00ffe755;
            border-radius: 14px;
            color: #c3ffe9;
            font-size: 1em;
            letter-spacing: 0.3px;
            box-shadow: 0 2px 14px #7e30ff20;
        }
        .result-area {
            background: #1e1f3a;
            color: #feffe2;
            border-radius: 14px;
            margin: 1em 0;
            padding: 1.5em;
            font-size: 0.95em;
            box-shadow: 0 2px 14px #00ffe724;
            text-align: left;
            max-height: 70vh;
            overflow-y: auto;
            border: 2px solid #30d0ff55;
        }
        .result-area::-webkit-scrollbar {
            width: 10px;
        }
        .result-area::-webkit-scrollbar-track {
            background: #0f1020;
            border-radius: 10px;
        }
        .result-area::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #22ffe6, #d601fc);
            border-radius: 10px;
        }
        .risk-header {
            background: linear-gradient(90deg, #22ffe6, #d601fc);
            padding: 1em;
            border-radius: 10px;
            margin-bottom: 1em;
            color: #fff;
            font-weight: bold;
        }
        .risk-high {
            background: linear-gradient(90deg, #ff2e63, #d601fc);
        }
        .risk-medium {
            background: linear-gradient(90deg, #ffaa00, #ff6b35);
        }
        .risk-low {
            background: linear-gradient(90deg, #00d9ff, #0abfbc);
        }
        .section-title {
            color: #22ffe6;
            font-weight: 600;
            font-size: 1.1em;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            padding-bottom: 0.3em;
            border-bottom: 2px solid #30d0ff55;
        }
        pre {
            background: #0f1020;
            padding: 1em;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.9em;
            line-height: 1.5;
            border: 1px solid #30d0ff33;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        hr {
            border: none;
            border-top: 2px solid #30d0ff;
            margin: 1.5em 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><span class="accent">Email</span> Forensics Analyzer</h1>
        <div class="file-input" onclick="document.getElementById('fileInput').click();">
            <strong>Drop your .eml email file or click to browse</strong>
            <input id="fileInput" type="file" accept=".eml,.txt" style="display:none;">
        </div>
        <button class="futuristic-btn" id="analyzeBtn">Analyze Email</button>
        <div class="info-card">
            <span id="statusMsg">Upload an email file and press <b>Analyze Email</b> to view forensic summary and suspicious indicators.</span>
        </div>
        <div id="resultArea" class="result-area" style="display:none;"></div>
    </div>
    <script>
        const fileInput = document.getElementById('fileInput');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const statusMsg = document.getElementById('statusMsg');
        const resultArea = document.getElementById('resultArea');
        let uploadedFile = null;

        fileInput.addEventListener('change', (e) => {
            uploadedFile = e.target.files[0];
            if (uploadedFile) {
                statusMsg.innerHTML = `<b style="color:#22ffe6;">Selected:</b> ${uploadedFile.name}`;
            } else {
                statusMsg.innerHTML = 'No file selected';
            }
        });

        analyzeBtn.onclick = async () => {
            if (!uploadedFile) {
                statusMsg.innerHTML = '<b style="color:#ff2e63;">‚ö† Please select a file first.</b>';
                return;
            }
            
            statusMsg.innerHTML = '<b style="color:#22ffe6;">üîç Analyzing email...</b>';
            resultArea.style.display = 'none';
            
            let formData = new FormData();
            formData.append("email_file", uploadedFile);
            
            try {
                let response = await fetch("/analyze_email", {method:"POST", body: formData});
                let result = await response.json();
                
                if (result.error) {
                    statusMsg.innerHTML = `<b style="color:#ff2e63;">Error:</b> ${result.error}`;
                    resultArea.innerHTML = "";
                    resultArea.style.display = 'none';
                } else {
                    statusMsg.innerHTML = '<b style="color:#0abfbc;">‚úì Analysis complete. See result below.</b>';
                    
                    let riskClass = 'risk-low';
                    if (result.risk.level === 'HIGH') riskClass = 'risk-high';
                    else if (result.risk.level === 'MEDIUM') riskClass = 'risk-medium';
                    
                    let html = `<div class="risk-header ${riskClass}">
                        <h3 style="margin:0;">Risk Score: ${result.risk.level} (${result.risk.score}/100)</h3>
                    </div>`;
                    
                    html += `<div style="margin-bottom:1em;">`;
                    html += `<b style="color:#f161ff;">üö® Indicators:</b> `;
                    if (result.risk.indicators.length > 0) {
                        html += result.risk.indicators.map(ind => `<span style="background:#30d0ff33; padding:0.3em 0.6em; border-radius:5px; margin:0.2em; display:inline-block;">${ind}</span>`).join(' ');
                    } else {
                        html += `<span style="color:#0abfbc;">None detected</span>`;
                    }
                    html += `</div>`;
                    
                    html += `<hr>`;
                    
                    html += `<div class="section-title">üìß Headers</div>`;
                    html += `<pre>${JSON.stringify(result.headers, null, 2)}</pre>`;
                    
                    html += `<div class="section-title">üîí DNS Checks</div>`;
                    html += `<pre>${JSON.stringify(result.dns_checks, null, 2)}</pre>`;
                    
                    html += `<div class="section-title">üìé Attachment Summary</div>`;
                    html += `<pre>${JSON.stringify(result.attachments, null, 2)}</pre>`;
                    
                    html += `<div class="section-title">üåê IPs & URLs</div>`;
                    html += `<pre>${JSON.stringify(result.ips_urls, null, 2)}</pre>`;
                    
                    resultArea.innerHTML = html;
                    resultArea.style.display = 'block';
                    
                    // Smooth scroll to results
                    setTimeout(() => {
                        resultArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 100);
                }
            } catch (error) {
                statusMsg.innerHTML = `<b style="color:#ff2e63;">‚ö† Error:</b> ${error.message}`;
                resultArea.innerHTML = "";
                resultArea.style.display = 'none';
            }
        };
    </script>
</body>
</html>
